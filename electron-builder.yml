# Electron Builder Configuration for Seline
# https://www.electron.build/configuration/configuration

appId: "ai.zlutty.app"
productName: "Seline"
copyright: "Copyright Â© 2024-2025 Zlutty.AI"
icon: "build-resources/icon.png"

# Directories
directories:
  buildResources: "build-resources"
  output: "dist-electron"

# Files to include in the asar (only Electron main/preload)
files:
  - "electron-dist/**/*"
  - "package.json"
  - "!**/node_modules/**"
  - "!**/.cache/**"
  - "!**/*.map"

# Extra resources - these stay OUTSIDE the asar archive
extraResources:
  # Next.js standalone server (needs to be outside asar to spawn)
  # Note: We explicitly include node_modules as electron-builder excludes it by default
  - from: ".next/standalone"
    to: "standalone"
    filter:
      - "**/*"
      - "!**/node_modules"
      - "!**/comfyui_backend"
      - "!**/comfyui_backend/**"
      - "!**/models"
      - "!**/models/**"
      - "!**/binaries"
      - "!**/binaries/**"
      - "!**/.local-data"
      - "!**/dist-electron"
      - "!**/.git"
      - "!**/.env*"
      - "!**/drizzle"
      - "!**/.cache"
      - "!**/@remotion/studio"
      - "!**/typescript"
      - "!**/webpack"
      - "!**/@huggingface/transformers/node_modules/onnxruntime-node"
      - "!**/@huggingface/transformers/node_modules/onnxruntime-web"
      - "!**/*.map"
      - "!**/*.ts"
      - "!**/test"
      - "!**/tests"
      # Exclude bundled source code (Next.js standalone copies project root)
      - "!**/seline-source"
      - "!**/seline-source/**"
      - "!app"
      - "!app/**"
      - "!components"
      - "!components/**"
      - "!hooks"
      - "!hooks/**"
      - "!i18n"
      - "!i18n/**"
  # Standalone node_modules (explicitly included since it's excluded by default)
  - from: ".next/standalone/node_modules"
    to: "standalone/node_modules"
    filter:
      - "**/*"
      - "!**/.cache/**"
      - "!**/*.map"
      - "!**/test/**"
      - "!**/tests/**"
      - "!**/__tests__/**"
  # Turbopack external module wrappers (lives inside .next/node_modules, excluded by the !**/node_modules filter above)
  - from: ".next/standalone/.next/node_modules"
    to: "standalone/.next/node_modules"
    filter:
      - "**/*"
  # Static assets for Next.js
  - from: ".next/static"
    to: "standalone/.next/static"
    filter:
      - "**/*"
  # Public folder (optional - we handle existence in preparation script)
  - from: "public"
    to: "standalone/public"
    filter:
      - "**/*"
  # Local embedding models (optional, bundled outside asar for offline use)
  - from: "models"
    to: "models"
    filter:
      - "**/*"
      - "!**/model_quantized.onnx"
      - "!**/bge-large-en-v1.5/**"
  # Bundled whisper-cli + dylibs for local speech-to-text
  - from: "binaries/whisper"
    to: "binaries/whisper"
    filter:
      - "**/*"
  # Bundled RTK binaries for experimental command token optimization
  - from: "binaries/rtk"
    to: "binaries/rtk"
    filter:
      - "**/*"
  # ComfyUI backend infrastructure (lightweight files only - no models)
  - from: "comfyui_backend"
    to: "comfyui_backend"
    filter:
      - "**/*"
      - "!ComfyUI/models/**/*.safetensors"
      - "!ComfyUI/models/**/*.ckpt"
      - "!ComfyUI/models/**/*.pt"
      - "!ComfyUI/models/**/*.bin"
      - "!output/**"
      - "!images/**"
      - "!inputs/**"
      - "!**/*.png"
      - "!**/__pycache__/**"
      - "!**/.git/**"
      - "!**/node_modules/**"
      - "!**/.venv/**"
      - "!**/venv/**"

# Compression settings
asar: true
compression: "normal"

# Run notarization hook after macOS signing completes.
afterSign: "scripts/notarize.js"

# Disable npm rebuild - we handle this in electron:rebuild-standalone
npmRebuild: false

# macOS specific configuration
mac:
  category: "public.app-category.entertainment"
  hardenedRuntime: true
  gatekeeperAssess: false
  entitlements: "build-resources/entitlements.mac.plist"
  entitlementsInherit: "build-resources/entitlements.mac.inherit.plist"
  # icon: "build-resources/icon.icns"
  # Build only for current architecture by default (use CLI flags to override)
  target:
    - target: "dmg"
    - target: "dir"
  extendInfo:
    NSCameraUsageDescription: "This app requires access to your camera for image capture."
    NSMicrophoneUsageDescription: "This app requires access to your microphone for audio capture."

# Windows specific configuration
win:
  target:
    - target: "nsis"
    - target: "portable"
  # icon: "build-resources/icon.ico"
  legalTrademarks: "Seline is a trademark of Seline"

# NSIS installer settings
nsis:
  oneClick: false
  allowToChangeInstallationDirectory: true
  createDesktopShortcut: true
  createStartMenuShortcut: true
  shortcutName: "Seline"
  artifactName: "${productName}-Setup-${version}.${ext}"
  uninstallDisplayName: "Seline"
  deleteAppDataOnUninstall: false

# DMG settings for macOS
dmg:
  sign: true
  contents:
    - x: 130
      y: 220
    - x: 410
      y: 220
      type: "link"
      path: "/Applications"
  window:
    width: 540
    height: 380


# Publish configuration (for auto-updates)
# publish:
#   provider: "github"
#   owner: "your-github-username"
#   repo: "styly-agent"

# Protocol registration (for deep linking)
protocols:
  - name: "zlutty"
    schemes:
      - "zlutty"
